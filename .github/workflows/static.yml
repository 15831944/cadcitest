name: BRL-CAD Static Analysis

on:
  push:
    branches: [ master ]

jobs:

  linux:
    name: Ubuntu Clang Analyser
    runs-on: ubuntu-latest
    strategy:
      fail-fast: true
    steps:
      - name: Setup - CMake
        uses: lukka/get-cmake@latest

      - name: Setup - Ninja
        uses: seanmiddleditch/gha-setup-ninja@master

        # https://github.com/darktable-org/rawspeed/blob/develop/.github/workflows/ci-static-analysis.yml
      - name: Clang Static Analyzer Setup
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
          sudo apt-get update
          sudo apt-get upgrade
          sudo apt-get install clang++-10 clang-tools-10
          sudo apt-get clean

      - name: Checkout
        uses: actions/checkout@v2

      - name: Run Analyzer
        run: |
          pwd
          export PATH=$ENV{GITHUB_WORKSPACE}:/usr/share/clang/scan-build-10/libexec:$PATH
          mkdir build && cd build && cp ../misc/clang-static-analyzer-run.sh .
          ./clang-static-analyzer-run.sh
